name: ğŸš€ Deploy Smart MCQ Platform

on:
  push:
    branches: [main]
  workflow_dispatch: # Allow manual trigger

jobs:
  deploy:
    name: ğŸ—ï¸ Build and Deploy
    runs-on: self-hosted
    
    steps:
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: ğŸ”§ Make Deploy Script Executable
        run: chmod +x build-and-deploy.sh
      
      - name: ğŸ“ Create Environment File
        run: |
          echo "ğŸ“ Creating .env file for deployment..."
          cp /root/smart-mcq/smart-mcq-dj/.env ./.env || echo "Warning: Could not copy .env file from production location"
      
      - name: ğŸš€ Run Build and Deploy Script
        run: |
          echo "ğŸš€ Running build-and-deploy.sh script..."
          echo "ğŸ“… Started at: $(date)"
          echo "ğŸ“ Commit: ${{ github.sha }}"
          echo "ğŸ‘¤ Triggered by: ${{ github.actor }}"
          echo "----------------------------------------"
          ./build-and-deploy.sh
      
      - name: ğŸ”” Deployment Success Notification
        run: |
          echo "----------------------------------------"
          echo "ğŸ‰ Deployment completed successfully!"
          echo "ğŸ“… Deployed at: $(date)"
          echo "ğŸ“ Commit: ${{ github.sha }}"
          echo "ğŸ‘¤ Triggered by: ${{ github.actor }}"
          echo "ğŸŒ Application should be available at: http://localhost/"
          echo "ğŸ”‘ Admin login: admin / admin123"
        if: success()
      
      - name: âŒ Deployment Failure Notification
        run: |
          echo "----------------------------------------"
          echo "ğŸ’¥ Deployment failed!"
          echo "ğŸ“… Failed at: $(date)"
          echo "ğŸ“ Commit: ${{ github.sha }}"
          echo "ğŸ‘¤ Triggered by: ${{ github.actor }}"
          echo "ğŸ” Check the build-and-deploy.sh script output above for details"
        if: failure()